# WEB动态加速思路

* IP层优化(网络路由优化)
* 传输层优化(TCP慢启动窗口协商/连接复用)
* 应用层优化(伪静态页面/预抓取)
* 针对web浏览器及相关操作系统等应用层以外的一些要素进行页面加速

#### 1. IP层优化(网络路由优化)
主要解决思路: 利用akamai在全球覆盖1100多家ISP服务商及2500个IDC,来进行路由信息计算获取较好的路由路径选择和故障检测;  

 I. 覆盖面:全球覆盖1100多家ISP服务商及2500个IDC  
 I. 路由路径估算及调整: 

    1. 收集: 收集部署于全球IDC的路由探测数据; (设定业务探测页面,每6分钟更新探测数据;)
    2. 反馈: 通过收集的数据在网络控制中心进行计算, 构建最优网络路由表下发akamai各个边缘节点用于路由决策;
    3. 决策: 估算出最优,次优及默认BGP路由路径, 然后根据实际网络状况选择路由路径;

#### 2. 传输层优化(TCP慢启动窗口协商/连接复用)
 I. TCP慢启动窗口协商优化: 由于网络存在链路拥塞的状态,需要在客户端及服务器端协商一个滑动窗口大小,默认情况下会从一个较小的拥塞窗口开始,每次往返都令其翻倍(指数增长),最终达到某个目标吞吐量; akamai通过其探测数据,默认提高初始拥塞窗口值来提升速度,减少往返次数;  
 I. 连接复用: 其原理主要是减少tcp在连接建立时的三次握手协议的时间消耗, 针对多个用户在同一CDN节点对于源站的HTTP get等请求复用同一个tcp连接;  

#### 3. 应用层优化(伪静态页面/预抓取)
 I. 通过将页面信息细划分, 针对动态页面的静态元素进行CDN本地缓存来提高相应时间;  
 I. 页面及子页面预抓取; 在用户访问动态页面的时候, 通过akamai系统对于页面分析, 提前向源站请求获取动态数据,利用时间差来提高用户体验; 同时可以对子页面也可以配置预抓取,通过预测用户行为来调高用户体验;

#### 4. 针对web浏览器及相关操作系统等应用层以外的一些要素进行页面加速:
 I. 如通过akamai对页面进行重写, 对js/css文件进行合并,图片内嵌到页面中等技术减少浏览器与服务器的交互次数;  
 I. 对页面进行压缩及rewrite页面(去除页面空格/注释等)减少交互数据量;  
 I. 加速渲染, 将动态页面的一些不可见元素放到展示元素之后来处理,如js后台计算等;  


#### 5. TCP的优化建议
 I. TCP三次握手增加了整整一次往返时间;  
 I. TCP慢启动将被应用到每个新连接;  
 I. TCP流量及拥塞控制会影响所有连接的吞吐量;
 I. TCP的吞吐量由当前拥塞窗口大小控制; 

    a)服务器配置调优: 
    1. 增大TCP的初始拥塞窗口;
    2. 禁用慢启动重启;
    3. 打开窗口缩放(RFC1323);
    4. TCP快速打开(TFO);  

    b) 性能检查清单: 
    1. 把服务器内核升级到最新版本;
    2. 确保cwnd大小为10;
    3. 禁用空闲后的慢启动;
    4. 确保启动窗口缩放;
    5. 减少传输冗余数据;
    6. 压缩要传输的数据 或 减少传输数据;
    7. 把服务器放到离用户近的地方以减少往返时间;
    8. 尽最大可能重用已经建立的TCP连接; 